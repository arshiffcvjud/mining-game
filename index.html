<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³ÛŒØ± Ø²Ù†Ø¯Ú¯ÛŒ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #34495e;
            --light: #ecf0f1;
            --text: #2c3e50;
        }
        
        body {
            font-family: Tahoma, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light);
            color: var(--text);
            direction: rtl;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            color: var(--dark);
        }
        
        .game-screen {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .stat-item {
            background-color: var(--light);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            flex-grow: 1;
            text-align: center;
            min-width: 80px;
        }
        
        .events {
            margin-bottom: 20px;
        }
        
        .event {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.secondary {
            background-color: var(--secondary);
        }
        
        button.secondary:hover {
            background-color: #27ae60;
        }
        
        button.warning {
            background-color: var(--warning);
        }
        
        button.danger {
            background-color: var(--danger);
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .health-bar {
            background-color: #2ecc71;
        }
        
        .happiness-bar {
            background-color: #f1c40f;
        }
        
        .education-bar {
            background-color: #3498db;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 500px;
            margin: 50px auto;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .modal-close {
            float: left;
            cursor: pointer;
            font-size: 20px;
        }
        
        .notification {
            background-color: var(--warning);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ù…Ø³ÛŒØ± Ø²Ù†Ø¯Ú¯ÛŒ</h1>
            <p class="subtitle">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ Ø§Ø² ØªÙˆÙ„Ø¯ ØªØ§ Ù…Ø±Ú¯</p>
        </div>
        
        <div id="startScreen" class="game-screen">
            <h2>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
            <p>Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒØŒ Ø´Ù…Ø§ Ù…Ø³ÛŒØ± Ø²Ù†Ø¯Ú¯ÛŒ ÛŒÚ© Ø§Ù†Ø³Ø§Ù† Ø±Ø§ Ø§Ø² ØªÙˆÙ„Ø¯ ØªØ§ Ù…Ø±Ú¯ Ù‡Ø¯Ø§ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.</p>
            <p>ØªØµÙ…ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ØŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø´Ø®ØµÛŒØª Ø±Ø§ Ø´Ú©Ù„ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
            
            <div class="form-group">
                <label for="playerName">Ù†Ø§Ù… Ø´Ø®ØµÛŒØª:</label>
                <input type="text" id="playerName" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
            </div>
            
            <div class="form-group">
                <label>Ø¬Ù†Ø³ÛŒØª:</label>
                <div>
                    <input type="radio" id="male" name="gender" value="male" checked>
                    <label for="male">Ù…Ø±Ø¯</label>
                    
                    <input type="radio" id="female" name="gender" value="female">
                    <label for="female">Ø²Ù†</label>
                </div>
            </div>
            
            <button id="startGame" class="secondary">Ø´Ø±ÙˆØ¹ Ø²Ù†Ø¯Ú¯ÛŒ</button>
        </div>
        
        <div id="gameScreen" class="game-screen hidden">
            <div class="notification" id="notification"></div>
            
            <div class="stats">
                <div class="stat-item">
                    <div>Ø³Ù†</div>
                    <div id="age">Û°</div>
                </div>
                <div class="stat-item">
                    <div>Ù¾ÙˆÙ„</div>
                    <div id="money">Û° ØªÙˆÙ…Ø§Ù†</div>
                </div>
                <div class="stat-item">
                    <div>Ø³Ù„Ø§Ù…ØªÛŒ</div>
                    <div class="progress-container">
                        <div class="progress-bar health-bar" id="healthBar"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div>Ø´Ø§Ø¯ÛŒ</div>
                    <div class="progress-container">
                        <div class="progress-bar happiness-bar" id="happinessBar"></div>
                    </div>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div>ØªØ­ØµÛŒÙ„Ø§Øª</div>
                    <div id="education">Ø¨ÛŒâ€ŒØ³ÙˆØ§Ø¯</div>
                </div>
                <div class="stat-item">
                    <div>Ø´ØºÙ„</div>
                    <div id="job">Ø¨ÛŒÚ©Ø§Ø±</div>
                </div>
                <div class="stat-item">
                    <div>ÙˆØ¶Ø¹ÛŒØª</div>
                    <div id="status">Ú©ÙˆØ¯Ú©</div>
                </div>
            </div>
            
            <div class="game-content">
                <h3>Ø±ÙˆÛŒØ¯Ø§Ø¯â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
                <div id="events" class="events">
                    <div class="event">Ù…ØªÙˆÙ„Ø¯ Ø´Ø¯ÛŒØ¯. Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø§Ø² Ø¯ÛŒØ¯Ù† Ø´Ù…Ø§ Ø®ÙˆØ´Ø­Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯.</div>
                </div>
                
                <h3>ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h3>
                <div id="actions" class="actions">
                    <button id="nextYear">Ø³Ø§Ù„ Ø¨Ø¹Ø¯</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ø§Ù…Ù„Ø§Ú© Ùˆ Ù…Ø³ØªØºÙ„Ø§Øª <span class="modal-close" onclick="closeModal('propertyModal')">Ã—</span></div>
            <div id="propertyContent"></div>
        </div>
    </div>
    
    <div id="educationModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ØªØ­ØµÛŒÙ„Ø§Øª <span class="modal-close" onclick="closeModal('educationModal')">Ã—</span></div>
            <div id="educationContent"></div>
        </div>
    </div>
    
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ù…Ø´Ø§ØºÙ„ <span class="modal-close" onclick="closeModal('jobModal')">Ã—</span></div>
            <div id="jobContent"></div>
        </div>
    </div>
    
    <div id="bankModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ø®Ø¯Ù…Ø§Øª Ø¨Ø§Ù†Ú©ÛŒ <span class="modal-close" onclick="closeModal('bankModal')">Ã—</span></div>
            <div id="bankContent"></div>
        </div>
    </div>
    
    <div id="skillsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ <span class="modal-close" onclick="closeModal('skillsModal')">Ã—</span></div>
            <div id="skillsContent"></div>
        </div>
    </div>
    
    <div id="shoppingModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ø®Ø±ÛŒØ¯ <span class="modal-close" onclick="closeModal('shoppingModal')">Ã—</span></div>
            <div id="shoppingContent"></div>
        </div>
    </div>
    
    <div id="lifeEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù‡Ù… <span class="modal-close" onclick="closeModal('lifeEventModal')">Ã—</span></div>
            <div id="lifeEventContent"></div>
        </div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… ÙˆØ¨ Ø§Ù¾
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
        function toPersianNum(num) {
            const persianDigits = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
            return String(num).replace(/[0-9]/g, function(w) {
                return persianDigits[+w];
            });
        }
        
        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ù‡ ÙØ±Ù…Øª Ù¾ÙˆÙ„
        function formatMoney(amount) {
            return toPersianNum(amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")) + " ØªÙˆÙ…Ø§Ù†";
        }
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        let player = {
            name: "",
            gender: "male",
            age: 0,
            money: 0,
            health: 100,
            happiness: 100,
            education: "Ø¨ÛŒâ€ŒØ³ÙˆØ§Ø¯",
            educationLevel: 0,
            job: "Ø¨ÛŒÚ©Ø§Ø±",
            salary: 0,
            status: "Ú©ÙˆØ¯Ú©",
            skills: {},
            properties: [],
            bankAccount: {
                opened: false,
                balance: 0,
                loans: []
            },
            relationships: [],
            events: []
        };
        
        let gameData = {
            jobs: [
                {title: "Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡", minEducation: 1, salary: 3000000, minAge: 16},
                {title: "ÙØ±ÙˆØ´Ù†Ø¯Ù‡", minEducation: 2, salary: 4000000, minAge: 18},
                {title: "Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¯ÙØªØ±ÛŒ", minEducation: 3, salary: 5000000, minAge: 20},
                {title: "Ù…Ø¹Ù„Ù…", minEducation: 4, salary: 6000000, minAge: 22},
                {title: "Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³", minEducation: 4, salary: 10000000, minAge: 20},
                {title: "Ù¾Ø²Ø´Ú©", minEducation: 6, salary: 20000000, minAge: 25},
                {title: "Ù…Ø¯ÛŒØ± Ø´Ø±Ú©Øª", minEducation: 5, salary: 15000000, minAge: 30}
            ],
            educations: [
                {title: "Ø¨ÛŒâ€ŒØ³ÙˆØ§Ø¯", level: 0, minAge: 0},
                {title: "Ø¯Ø¨Ø³ØªØ§Ù†", level: 1, minAge: 7, years: 6},
                {title: "Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†", level: 2, minAge: 13, years: 6},
                {title: "Ú©Ø§Ø±Ø¯Ø§Ù†ÛŒ", level: 3, minAge: 18, years: 2},
                {title: "Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ", level: 4, minAge: 18, years: 4},
                {title: "Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ Ø§Ø±Ø´Ø¯", level: 5, minAge: 22, years: 2},
                {title: "Ø¯Ú©ØªØ±Ø§", level: 6, minAge: 24, years: 4}
            ],
            properties: [
                {title: "Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ú©ÙˆÚ†Ú©", price: 500000000, rent: 5000000, type: "home"},
                {title: "Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ù…ØªÙˆØ³Ø·", price: 1000000000, rent: 8000000, type: "home"},
                {title: "Ø®Ø§Ù†Ù‡ ÙˆÛŒÙ„Ø§ÛŒÛŒ", price: 2000000000, rent: 12000000, type: "home"},
                {title: "ÙˆÛŒÙ„Ø§ÛŒ Ø´Ù…Ø§Ù„", price: 3000000000, rent: 20000000, type: "vacation"},
                {title: "Ø¯ÙØªØ± Ú©Ø§Ø±", price: 1500000000, rent: 10000000, type: "business"}
            ],
            vehicles: [
                {title: "Ø¯ÙˆÚ†Ø±Ø®Ù‡", price: 5000000, type: "bicycle"},
                {title: "Ù…ÙˆØªÙˆØ±Ø³ÛŒÚ©Ù„Øª", price: 50000000, type: "motorcycle"},
                {title: "Ø®ÙˆØ¯Ø±Ùˆ Ù¾Ø±Ø§ÛŒØ¯", price: 200000000, type: "car"},
                {title: "Ø®ÙˆØ¯Ø±Ùˆ Û²Û°Û¶", price: 300000000, type: "car"},
                {title: "Ø®ÙˆØ¯Ø±Ùˆ Ù„ÙˆÚ©Ø³", price: 1000000000, type: "car"}
            ],
            skills: [
                {title: "Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ", price: 5000000, benefit: "job"},
                {title: "Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ", price: 8000000, benefit: "job"},
                {title: "Ø¢Ø´Ù¾Ø²ÛŒ", price: 3000000, benefit: "happiness"},
                {title: "Ù†Ù‚Ø§Ø´ÛŒ", price: 4000000, benefit: "happiness"},
                {title: "Ù…ÙˆØ³ÛŒÙ‚ÛŒ", price: 7000000, benefit: "happiness"},
                {title: "ÙˆØ±Ø²Ø´ Ø¨Ø¯Ù†Ø³Ø§Ø²ÛŒ", price: 6000000, benefit: "health"},
                {title: "Ø´Ù†Ø§", price: 4000000, benefit: "health"},
                {title: "ÛŒÙˆÚ¯Ø§", price: 3000000, benefit: "health"}
            ],
            lifeEvents: [
                {title: "Ø¨ÛŒÙ…Ø§Ø±ÛŒ", effect: "health", value: -20, probability: 0.1},
                {title: "Ø¬Ø§ÛŒØ²Ù‡", effect: "money", value: 1000000, probability: 0.05},
                {title: "ØªØµØ§Ø¯Ù", effect: "health", value: -30, probability: 0.03},
                {title: "Ø§ØªÙØ§Ù‚ Ø®ÙˆØ¨", effect: "happiness", value: 20, probability: 0.2}
            ]
        };
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
        document.getElementById('startGame').addEventListener('click', function() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø´Ø®ØµÛŒØª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            player.name = name;
            player.gender = document.querySelector('input[name="gender"]:checked').value;
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            updateUI();
            addEvent(`${player.name} Ù…ØªÙˆÙ„Ø¯ Ø´Ø¯. Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø§Ø² Ø¯ÛŒØ¯Ù† Ø§Ùˆ Ø®ÙˆØ´Ø­Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯.`);
        });
        
        // Ø¯Ú©Ù…Ù‡ Ø³Ø§Ù„ Ø¨Ø¹Ø¯
        document.getElementById('nextYear').addEventListener('click', nextYear);
        
        // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        function updateUI() {
            document.getElementById('age').textContent = toPersianNum(player.age);
            document.getElementById('money').textContent = formatMoney(player.money);
            document.getElementById('education').textContent = player.education;
            document.getElementById('job').textContent = player.job;
            document.getElementById('status').textContent = player.status;
            
            document.getElementById('healthBar').style.width = player.health + '%';
            document.getElementById('happinessBar').style.width = player.happiness + '%';
            
            updateAvailableActions();
        }
        
        // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³
        function updateAvailableActions() {
            const actionsDiv = document.getElementById('actions');
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¨Ù‡ Ø¬Ø² Ø³Ø§Ù„ Ø¨Ø¹Ø¯
            const buttons = actionsDiv.querySelectorAll('button:not(#nextYear)');
            buttons.forEach(btn => btn.remove());
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ù†
            
            // Ø¯Ú©Ù…Ù‡ ØªØ­ØµÛŒÙ„
            if (player.age >= 7 && player.educationLevel < 6) {
                const educationBtn = document.createElement('button');
                educationBtn.textContent = 'ØªØ­ØµÛŒÙ„';
                educationBtn.className = 'secondary';
                educationBtn.addEventListener('click', function() {
                    openEducationModal();
                });
                actionsDiv.appendChild(educationBtn);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù†Ú©
            if (player.age >= 18) {
                const bankBtn = document.createElement('button');
                bankBtn.textContent = 'Ø¨Ø§Ù†Ú©';
                bankBtn.addEventListener('click', function() {
                    openBankModal();
                });
                actionsDiv.appendChild(bankBtn);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ú©Ø§Ø±
            if (player.age >= 16) {
                const jobBtn = document.createElement('button');
                jobBtn.textContent = 'Ø´ØºÙ„';
                jobBtn.addEventListener('click', function() {
                    openJobModal();
                });
                actionsDiv.appendChild(jobBtn);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ø®Ø±ÛŒØ¯ Ù…Ù„Ú©
            if (player.age >= 18) {
                const propertyBtn = document.createElement('button');
                propertyBtn.textContent = 'Ø§Ù…Ù„Ø§Ú©';
                propertyBtn.addEventListener('click', function() {
                    openPropertyModal();
                });
                actionsDiv.appendChild(propertyBtn);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§
            if (player.age >= 10) {
                const skillsBtn = document.createElement('button');
                skillsBtn.textContent = 'Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§';
                skillsBtn.className = 'secondary';
                skillsBtn.addEventListener('click', function() {
                    openSkillsModal();
                });
                actionsDiv.appendChild(skillsBtn);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ø®Ø±ÛŒØ¯
            if (player.age >= 12) {
                const shoppingBtn = document.createElement('button');
                shoppingBtn.textContent = 'Ø®Ø±ÛŒØ¯';
                shoppingBtn.addEventListener('click', function() {
                    openShoppingModal();
                });
                actionsDiv.appendChild(shoppingBtn);
            }
        }
        
        // Ø§ÙØ²ÙˆØ¯Ù† ÛŒÚ© Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
        function addEvent(message) {
            const eventsDiv = document.getElementById('events');
            const eventElement = document.createElement('div');
            eventElement.className = 'event';
            eventElement.textContent = message;
            eventsDiv.prepend(eventElement);
            
            // Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
            const allEvents = eventsDiv.querySelectorAll('.event');
            if (allEvents.length > 5) {
                eventsDiv.removeChild(allEvents[allEvents.length - 1]);
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†
            player.events.push({
                age: player.age,
                message: message
            });
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }
        
        // Ø³Ø§Ù„ Ø¨Ø¹Ø¯
        function nextYear() {
            player.age++;
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª
            updateStatus();
            
            // Ø¯Ø±Ø¢Ù…Ø¯ Ø³Ø§Ù„Ø§Ù†Ù‡
            if (player.job !== "Ø¨ÛŒÚ©Ø§Ø±") {
                player.money += player.salary;
                addEvent(`Ø§Ø² Ø´ØºÙ„ ${player.job} Ù…Ø¨Ù„Øº ${formatMoney(player.salary)} Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø³Ø¨ Ú©Ø±Ø¯ÛŒØ¯.`);
            }
            
            // Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø¬Ø§Ø±Ù‡ Ø§Ù…Ù„Ø§Ú©
            player.properties.forEach(property => {
                if (property.isRenting) {
                    player.money += property.rent;
                    addEvent(`Ø§Ø² Ø§Ø¬Ø§Ø±Ù‡ ${property.title} Ù…Ø¨Ù„Øº ${formatMoney(property.rent)} Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
                }
            });
            
            // Ø¨Ù‡Ø±Ù‡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ
            if (player.bankAccount.opened && player.bankAccount.balance > 0) {
                const interest = Math.floor(player.bankAccount.balance * 0.15); // 15% Ø³ÙˆØ¯ Ø³Ø§Ù„Ø§Ù†Ù‡
                player.bankAccount.balance += interest;
                addEvent(`Ø³ÙˆØ¯ Ø¨Ø§Ù†Ú©ÛŒ: ${formatMoney(interest)}`);
            }
            
            // Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø· ÙˆØ§Ù…
            if (player.bankAccount.loans.length > 0) {
                player.bankAccount.loans.forEach((loan, index) => {
                    if (loan.remainingPayments > 0) {
                        player.money -= loan.monthlyPayment;
                        loan.remainingPayments--;
                        
                        if (loan.remainingPayments === 0) {
                            addEvent(`ÙˆØ§Ù… Ø´Ù…Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯.`);
                            player.bankAccount.loans.splice(index, 1);
                        } else {
                            addEvent(`Ù‚Ø³Ø· ÙˆØ§Ù…: ${formatMoney(loan.monthlyPayment)} Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯. ${toPersianNum(loan.remainingPayments)} Ù‚Ø³Ø· Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡.`);
                        }
                    }
                });
            }
            
            // Ú©Ø§Ù‡Ø´ Ø·Ø¨ÛŒØ¹ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ Ø¨Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ø³Ù†
            if (player.age > 50) {
                player.health -= (player.age - 50) / 10;
            }
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§ØªÙØ§Ù‚ÛŒ Ø²Ù†Ø¯Ú¯ÛŒ
            checkRandomLifeEvents();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø±Ú¯
            if (player.health <= 0 || player.age >= 100) {
                gameOver();
                return;
            }
            
            // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨ÛŒÙ† 0 ØªØ§ 100
            player.health = Math.max(0, Math.min(100, player.health));
            player.happiness = Math.max(0, Math.min(100, player.happiness));
            
            updateUI();
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§ØªÙØ§Ù‚ÛŒ
        function checkRandomLifeEvents() {
            gameData.lifeEvents.forEach(event => {
                if (Math.random() < event.probability) {
                    // Ø§Ø¹Ù…Ø§Ù„ Ø§Ø«Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯
                    player[event.effect] += event.value;
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒØ¯Ø§Ø¯
                    if (event.value > 0) {
                        addEvent(`${event.title}: ${event.effect === 'money' ? formatMoney(event.value) : toPersianNum(event.value)} Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.`);
                    } else {
                        addEvent(`${event.title}: ${event.effect === 'money' ? formatMoney(Math.abs(event.value)) : toPersianNum(Math.abs(event.value))} Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª.`);
                    }
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ø¬Ø±Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù‡Ù…
                    openLifeEventModal(event);
                }
            });
        }
        
        // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù†
        function updateStatus() {
            if (player.age < 6) {
                player.status = "Ú©ÙˆØ¯Ú©";
            } else if (player.age < 12) {
                player.status = "Ù†ÙˆØ¬ÙˆØ§Ù†";
            } else if (player.age < 18) {
                player.status = "Ù†ÙˆØ¬ÙˆØ§Ù†";
            } else if (player.age < 30) {
                player.status = "Ø¬ÙˆØ§Ù†";
            } else if (player.age < 50) {
                player.status = "Ù…ÛŒØ§Ù†Ø³Ø§Ù„";
            } else if (player.age < 70) {
                player.status = "Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„";
            } else {
                player.status = "Ú©Ù‡Ù†Ø³Ø§Ù„";
            }
        }
        
        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¯Ø§Ù„
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        // Ø¨Ø³ØªÙ† Ù…Ø¯Ø§Ù„
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Ù…Ø¯Ø§Ù„ ØªØ­ØµÛŒÙ„Ø§Øª
        function openEducationModal() {
            const content = document.getElementById('educationContent');
            content.innerHTML = '';
            
            const availableEducations = gameData.educations.filter(edu => {
                return edu.level > player.educationLevel && player.age >= edu.minAge;
            });
            
            if (availableEducations.length === 0) {
                content.innerHTML = '<p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ú¯Ø²ÛŒÙ†Ù‡ ØªØ­ØµÛŒÙ„ÛŒ Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
            } else {
                content.innerHTML = '<p>Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚Ø·Ø¹ ØªØ­ØµÛŒÙ„ÛŒ:</p>';
                
                availableEducations.forEach(edu => {
                    const button = document.createElement('button');
                    button.textContent = `${edu.title} (${toPersianNum(edu.years)} Ø³Ø§Ù„)`;
                    button.className = 'secondary';
                    button.style.margin = '5px';
                    button.addEventListener('click', function() {
                        startEducation(edu);
                        closeModal('educationModal');
                    });
                    content.appendChild(button);
                });
            }
            
            openModal('educationModal');
        }
        
        // Ø´Ø±ÙˆØ¹ ØªØ­ØµÛŒÙ„
        function startEducation(education) {
            for (let i = 0; i < education.years; i++) {
                player.age++;
                updateStatus();
                
                // Ú©Ø§Ù‡Ø´ Ø´Ø§Ø¯ÛŒ Ø¯Ø± Ø¯ÙˆØ±Ø§Ù† ØªØ­ØµÛŒÙ„
                player.happiness = Math.max(50, player.happiness - 5);
                
                // Ø§ÙØ²Ø§ÛŒØ´ ØªØµØ§Ø¯ÙÛŒ Ø´Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø®ÛŒ Ø³Ø§Ù„â€ŒÙ‡Ø§
                if (Math.random() > 0.7) {
                    player.happiness += 10;
                    addEvent(`Ø³Ø§Ù„ ØªØ­ØµÛŒÙ„ÛŒ Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø´ØªÛŒØ¯ Ùˆ Ø´Ø§Ø¯ÛŒ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.`);
                }
            }
            
            player.education = education.title;
            player.educationLevel = education.level;
            addEvent(`ØªØ­ØµÛŒÙ„Ø§Øª ${education.title} Ø±Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³Ø§Ù†Ø¯ÛŒØ¯.`);
            
            updateUI();
        }
        
        // Ù…Ø¯Ø§Ù„ Ø´ØºÙ„
        function openJobModal() {
            const content = document.getElementById('jobContent');
            content.innerHTML = '';
            
            // Ù†Ù…Ø§ÛŒØ´ Ø´ØºÙ„ ÙØ¹Ù„ÛŒ
            if (player.job !== "Ø¨ÛŒÚ©Ø§Ø±") {
                content.innerHTML += `<p>Ø´ØºÙ„ ÙØ¹Ù„ÛŒ: ${player.job} - Ø¯Ø±Ø¢Ù…Ø¯: ${formatMoney(player.salary)}</p>`;
                
                const quitButton = document.createElement('button');
                quitButton.textContent = 'Ø§Ø³ØªØ¹ÙØ§';
                quitButton.className = 'danger';
                quitButton.addEventListener('click', function() {
                    player.job = "Ø¨ÛŒÚ©Ø§Ø±";
                    player.salary = 0;
                    addEvent(`Ø´Ù…Ø§ Ø§Ø² Ø´ØºÙ„ Ø®ÙˆØ¯ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ø§Ø¯ÛŒØ¯.`);
                    updateUI();
                    closeModal('jobModal');
                });
                content.appendChild(quitButton);
                
                content.innerHTML += '<hr><p>Ø´ØºÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯:</p>';
            } else {
                content.innerHTML += '<p>Ø´ØºÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³:</p>';
            }
            
            // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø´ØºÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨
            const availableJobs = gameData.jobs.filter(job => {
                return job.minEducation <= player.educationLevel && job.minAge <= player.age;
            });
            
            if (availableJobs.length === 0) {
                content.innerHTML += '<p>Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª Ùˆ Ø³Ù† Ø´Ù…Ø§ØŒ Ø´ØºÙ„ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª.</p>';
            } else {
                availableJobs.forEach(job => {
                    const jobDiv = document.createElement('div');
                    jobDiv.className = 'job-item';
                    jobDiv.innerHTML = `<strong>${job.title}</strong> - Ø¯Ø±Ø¢Ù…Ø¯: ${formatMoney(job.salary)}`;
                    
                    const applyButton = document.createElement('button');
                    applyButton.textContent = 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª';
                    applyButton.style.marginRight = '10px';
                    applyButton.addEventListener('click', function() {
                        // Ø´Ø§Ù†Ø³ Ø§Ø³ØªØ®Ø¯Ø§Ù…
                        let hireChance = 0.5;
                        
                        // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·
                        if (player.skills["Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ"]) hireChance += 0.1;
                        if (player.skills["Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ"]) hireChance += 0.1;
                        
                        if (Math.random() < hireChance) {
                            player.job = job.title;
                            player.salary = job.salary;
                            addEvent(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¯Ø± Ø´ØºÙ„ ${job.title} Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¯ÛŒØ¯.`);
                            updateUI();
                            closeModal('jobModal');
                        } else {
                            showNotification("Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ù†Ø´Ø¯.", 2000);
                        }
                    });
                    
                    jobDiv.appendChild(applyButton);
                    content.appendChild(jobDiv);
                });
            }
            
            openModal('jobModal');
        }
        
        // Ù…Ø¯Ø§Ù„ Ø§Ù…Ù„Ø§Ú©
        function openPropertyModal() {
            const content = document.getElementById('propertyContent');
            content.innerHTML = '';
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ù…Ù„Ø§Ú© ÙØ¹Ù„ÛŒ
            if (player.properties.length > 0) {
                content.innerHTML += '<h3>Ø§Ù…Ù„Ø§Ú© Ø´Ù…Ø§</h3>';
                player.properties.forEach((property, index) => {
                    const propDiv = document.createElement('div');
                    propDiv.className = 'property-item';
                    propDiv.innerHTML = `<strong>${property.title}</strong> - Ø§Ø±Ø²Ø´: ${formatMoney(property.price)}`;
                    
                    if (property.isRenting) {
                        propDiv.innerHTML += ` - Ø§Ø¬Ø§Ø±Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡: ${formatMoney(property.rent)}`;
                        
                        const endRentButton = document.createElement('button');
                        endRentButton.textContent = 'Ù¾Ø§ÛŒØ§Ù† Ø§Ø¬Ø§Ø±Ù‡';
                        endRentButton.className = 'warning';
                        endRentButton.addEventListener('click', function() {
                            property.isRenting = false;
                            addEvent(`Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø§Ø¬Ø§Ø±Ù‡ ${property.title} Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.`);
                            updateUI();
                            openPropertyModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ Ù„ÛŒØ³Øª
                        });
                        propDiv.appendChild(endRentButton);
                    } else {
                        const rentButton = document.createElement('button');
                        rentButton.textContent = 'Ø§Ø¬Ø§Ø±Ù‡ Ø¯Ø§Ø¯Ù†';
                        rentButton.addEventListener('click', function() {
                            property.isRenting = true;
                            addEvent(`${property.title} Ø±Ø§ Ø¨Ø§ Ø§Ø¬Ø§Ø±Ù‡ ${formatMoney(property.rent)} Ø§Ø¬Ø§Ø±Ù‡ Ø¯Ø§Ø¯ÛŒØ¯.`);
                            updateUI();
                            openPropertyModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ Ù„ÛŒØ³Øª
                        });
                        propDiv.appendChild(rentButton);
                    }
                    
                    const sellButton = document.createElement('button');
                    sellButton.textContent = 'ÙØ±ÙˆØ´';
                    sellButton.className = 'danger';
                    sellButton.addEventListener('click', function() {
                        // ÙØ±ÙˆØ´ Ø¨Ø§ Û±Û°Ùª Ø¶Ø±Ø±
                        const sellPrice = Math.floor(property.price * 0.9);
                        player.money += sellPrice;
                        player.properties.splice(index, 1);
                        addEvent(`${property.title} Ø±Ø§ Ø¨Ø§ Ù‚ÛŒÙ…Øª ${formatMoney(sellPrice)} ÙØ±ÙˆØ®ØªÛŒØ¯.`);
                        updateUI();
                        openPropertyModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ Ù„ÛŒØ³Øª
                    });
                    propDiv.appendChild(sellButton);
                    
                    content.appendChild(propDiv);
                });
                
                content.innerHTML += '<hr><h3>Ø®Ø±ÛŒØ¯ Ù…Ù„Ú© Ø¬Ø¯ÛŒØ¯</h3>';
            } else {
                content.innerHTML += '<p>Ø´Ù…Ø§ Ù‡ÛŒÚ† Ù…Ù„Ú©ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p><h3>Ø®Ø±ÛŒØ¯ Ù…Ù„Ú©</h3>';
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ù…Ù„Ø§Ú© Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯
            gameData.properties.forEach(property => {
                const propDiv = document.createElement('div');
                propDiv.className = 'property-item';
                propDiv.innerHTML = `<strong>${property.title}</strong> - Ù‚ÛŒÙ…Øª: ${formatMoney(property.price)} - Ø§Ø¬Ø§Ø±Ù‡: ${formatMoney(property.rent)}`;
                
                const buyButton = document.createElement('button');
                buyButton.textContent = 'Ø®Ø±ÛŒØ¯';
                
                if (player.money < property.price) {
                    buyButton.disabled = true;
                    buyButton.title = 'Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯';
                }
                
                buyButton.addEventListener('click', function() {
                    if (player.money >= property.price) {
                        player.money -= property.price;
                        player.properties.push({...property, isRenting: false});
                        addEvent(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ ${property.title} Ø±Ø§ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø±Ø¯ÛŒØ¯.`);
                        updateUI();
                        openPropertyModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ Ù„ÛŒØ³Øª
                    } else {
                        showNotification("Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯", 2000);
                    }
                });
                
                propDiv.appendChild(buyButton);
                content.appendChild(propDiv);
            });
            
            openModal('propertyModal');
        }
        
        // Ù…Ø¯Ø§Ù„ Ø¨Ø§Ù†Ú©
        function openBankModal() {
            const content = document.getElementById('bankContent');
            content.innerHTML = '';
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨
            if (!player.bankAccount.opened) {
                const openAccountButton = document.createElement('button');
                openAccountButton.textContent = 'Ø§ÙØªØªØ§Ø­ Ø­Ø³Ø§Ø¨';
                openAccountButton.className = 'secondary';
                openAccountButton.addEventListener('click', function() {
                    player.bankAccount.opened = true;
                    addEvent('Ø´Ù…Ø§ ÛŒÚ© Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ Ø§ÙØªØªØ§Ø­ Ú©Ø±Ø¯ÛŒØ¯.');
                    openBankModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ 
                });
                
                content.innerHTML = '<p>Ø´Ù…Ø§ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';
                content.appendChild(openAccountButton);
            } else {
                content.innerHTML = `
                    <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨: ${formatMoney(player.bankAccount.balance)}</p>
                    <p>Ù†Ø±Ø® Ø³ÙˆØ¯ Ø³Ø§Ù„Ø§Ù†Ù‡: Û±ÛµÙª</p>
                    <div class="bank-actions">
                        <div class="form-group">
                            <label>Ù…Ø¨Ù„Øº:</label>
                            <input type="number" id="bankAmount" min="1000000" step="1000000" value="1000000">
                        </div>
                    </div>
                `;
                
                const depositButton = document.createElement('button');
                depositButton.textContent = 'ÙˆØ§Ø±ÛŒØ² Ø¨Ù‡ Ø­Ø³Ø§Ø¨';
                depositButton.addEventListener('click', function() {
                    const amount = parseInt(document.getElementById('bankAmount').value);
                    if (amount > 0 && player.money >= amount) {
                        player.money -= amount;
                        player.bankAccount.balance += amount;
                        addEvent(`Ø´Ù…Ø§ ${formatMoney(amount)} Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ ÙˆØ§Ø±ÛŒØ² Ú©Ø±Ø¯ÛŒØ¯.`);
                        updateUI();
                        openBankModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ
                    } else {
                        showNotification("Ù…Ø¨Ù„Øº Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù¾ÙˆÙ„ Ù†Ø§Ú©Ø§ÙÛŒ", 2000);
                    }
                });
                
                const withdrawButton = document.createElement('button');
                withdrawButton.textContent = 'Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨';
                withdrawButton.addEventListener('click', function() {
                    const amount = parseInt(document.getElementById('bankAmount').value);
                    if (amount > 0 && player.bankAccount.balance >= amount) {
                        player.money += amount;
                        player.bankAccount.balance -= amount;
                        addEvent(`Ø´Ù…Ø§ ${formatMoney(amount)} Ø§Ø² Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø±Ø¯ÛŒØ¯.`);
                        updateUI();
                        openBankModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ
                    } else {
                        showNotification("Ù…Ø¨Ù„Øº Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ø§Ú©Ø§ÙÛŒ", 2000);
                    }
                });
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'button-group';
                actionsDiv.appendChild(depositButton);
                actionsDiv.appendChild(withdrawButton);
                content.appendChild(actionsDiv);
                
                // Ø¨Ø®Ø´ ÙˆØ§Ù…
                content.innerHTML += '<hr><h3>Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆØ§Ù…</h3>';
                
                if (player.bankAccount.loans.length > 0) {
                    content.innerHTML += '<p>ÙˆØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ:</p>';
                    player.bankAccount.loans.forEach(loan => {
                        content.innerHTML += `<p>Ù…Ø¨Ù„Øº ÙˆØ§Ù…: ${formatMoney(loan.amount)} - Ù‚Ø³Ø· Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡: ${formatMoney(loan.monthlyPayment)} - Ø§Ù‚Ø³Ø§Ø· Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡: ${toPersianNum(loan.remainingPayments)}</p>`;
                    });
                }
                
                const canGetLoan = player.bankAccount.loans.length < 2;
                
                if (canGetLoan) {
                    content.innerHTML += `
                        <div class="form-group">
                            <label>Ù…Ø¨Ù„Øº ÙˆØ§Ù…:</label>
                            <input type="number" id="loanAmount" min="10000000" step="10000000" value="50000000">
                        </div>
                        <div class="form-group">
                            <p>Ù†Ø±Ø® Ø³ÙˆØ¯: Û²ÛµÙª Ø³Ø§Ù„Ø§Ù†Ù‡</p>
                            <p>Ù…Ø¯Øª Ø¨Ø§Ø²Ù¾Ø±Ø¯Ø§Ø®Øª: Ûµ Ø³Ø§Ù„</p>
                        </div>
                    `;
                    
                    const loanButton = document.createElement('button');
                    loanButton.textContent = 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆØ§Ù…';
                    loanButton.addEventListener('click', function() {
                        const amount = parseInt(document.getElementById('loanAmount').value);
                        if (amount >= 10000000) {
                            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ù‚Ø³Ø· Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø§ Ø³ÙˆØ¯ Û²ÛµÙª Ø³Ø§Ù„Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ûµ Ø³Ø§Ù„
                            const totalAmount = amount * 1.25;
                            const monthlyPayment = Math.floor(totalAmount / 60);
                            
                            player.money += amount;
                            player.bankAccount.loans.push({
                                amount: amount,
                                monthlyPayment: monthlyPayment,
                                remainingPayments: 60
                            });
                            
                            addEvent(`Ø´Ù…Ø§ ÙˆØ§Ù… ${formatMoney(amount)} Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
                            updateUI();
                            openBankModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ
                        } else {
                            showNotification("Ù…Ø¨Ù„Øº ÙˆØ§Ù… Ù†Ø§Ù…Ø¹ØªØ¨Ø±", 2000);
                        }
                    });
                    
                    content.appendChild(loanButton);
                } else {
                    content.innerHTML += '<p>Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¯Ùˆ ÙˆØ§Ù… ÙØ¹Ø§Ù„ Ø¯Ø§Ø±ÛŒØ¯ Ùˆ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆØ§Ù… Ø¬Ø¯ÛŒØ¯ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.</p>';
                }
            }
            
            openModal('bankModal');
        }
        
        // Ù…Ø¯Ø§Ù„ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§
        function openSkillsModal() {
            const content = document.getElementById('skillsContent');
            content.innerHTML = '';
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ
            content.innerHTML += '<h3>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</h3>';
            if (Object.keys(player.skills).length === 0) {
                content.innerHTML += '<p>Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ù…Ù‡Ø§Ø±ØªÛŒ Ú©Ø³Ø¨ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>';
            } else {
                const skillsList = document.createElement('ul');
                for (const skill in player.skills) {
                    const skillItem = document.createElement('li');
                    skillItem.textContent = skill;
                    skillsList.appendChild(skillItem);
                }
                content.appendChild(skillsList);
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ
            content.innerHTML += '<hr><h3>ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ù‡Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯</h3>';
            
            gameData.skills.forEach(skill => {
                if (!player.skills[skill.title]) {
                    const skillDiv = document.createElement('div');
                    skillDiv.className = 'skill-item';
                    skillDiv.innerHTML = `<strong>${skill.title}</strong> - Ù‡Ø²ÛŒÙ†Ù‡: ${formatMoney(skill.price)} - Ù…Ø²Ø§ÛŒØ§: ${skill.benefit === 'job' ? 'Ø´ØºÙ„ÛŒ' : skill.benefit === 'health' ? 'Ø³Ù„Ø§Ù…ØªÛŒ' : 'Ø´Ø§Ø¯ÛŒ'}`;
                    
                    const learnButton = document.createElement('button');
                    learnButton.textContent = 'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ';
                    
                    if (player.money < skill.price) {
                        learnButton.disabled = true;
                        learnButton.title = 'Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯';
                    }
                    
                    learnButton.addEventListener('click', function() {
                        if (player.money >= skill.price) {
                            player.money -= skill.price;
                            player.skills[skill.title] = true;
                            
                            // Ø§ÙØ²Ø§ÛŒØ´ Ù…Ø²Ø§ÛŒØ§
                            if (skill.benefit === 'health') {
                                player.health = Math.min(100, player.health + 10);
                            } else if (skill.benefit === 'happiness') {
                                player.happiness = Math.min(100, player.happiness + 10);
                            }
                            
                            addEvent(`Ø´Ù…Ø§ Ù…Ù‡Ø§Ø±Øª ${skill.title} Ø±Ø§ Ø¢Ù…ÙˆØ®ØªÛŒØ¯.`);
                            updateUI();
                            openSkillsModal(); // Ø¨Ø§Ø²Ù†Ù…Ø§ÛŒÛŒ Ù„ÛŒØ³Øª
                        } else {
                            showNotification("Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯", 2000);
                        }
                    });
                    
                    skillDiv.appendChild(learnButton);
                    content.appendChild(skillDiv);
                }
            });
            
            openModal('skillsModal');
        }
        
        // Ù…Ø¯Ø§Ù„ Ø®Ø±ÛŒØ¯
        function openShoppingModal() {
            const content = document.getElementById('shoppingContent');
            content.innerHTML = '';
            
            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡
            content.innerHTML += '<h3>ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡</h3>';
            
            gameData.vehicles.forEach(vehicle => {
                const vehicleDiv = document.createElement('div');
                vehicleDiv.className = 'shopping-item';
                vehicleDiv.innerHTML = `<strong>${vehicle.title}</strong> - Ù‚ÛŒÙ…Øª: ${formatMoney(vehicle.price)}`;
                
                const buyButton = document.createElement('button');
                buyButton.textContent = 'Ø®Ø±ÛŒØ¯';
                
                if (player.money < vehicle.price) {
                    buyButton.disabled = true;
                    buyButton.title = 'Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯';
                }
                
                buyButton.addEventListener('click', function() {
                    if (player.money >= vehicle.price) {
                        player.money -= vehicle.price;
                        if (!player.vehicles) player.vehicles = [];
                        player.vehicles.push({...vehicle});
                        addEvent(`Ø´Ù…Ø§ ${vehicle.title} Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø±Ø¯ÛŒØ¯.`);
                        player.happiness = Math.min(100, player.happiness + 5);
                        updateUI();
                        closeModal('shoppingModal');
                        showNotification(`${vehicle.title} Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯!`, 2000);
                    } else {
                        showNotification("Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯", 2000);
                    }
                });
                
                vehicleDiv.appendChild(buyButton);
                content.appendChild(vehicleDiv);
            });
            
            openModal('shoppingModal');
        }
        
        // Ù…Ø¯Ø§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù‡Ù… Ø²Ù†Ø¯Ú¯ÛŒ
        function openLifeEventModal(event) {
            const content = document.getElementById('lifeEventContent');
            
            let message = '';
            let icon = '';
            
            if (event.effect === 'health') {
                if (event.value < 0) {
                    message = `Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø´Ù…Ø§ Ø¯Ú†Ø§Ø± ${event.title} Ø´Ø¯ÛŒØ¯ Ùˆ Ø³Ù„Ø§Ù…ØªÛŒ Ø´Ù…Ø§ ${toPersianNum(Math.abs(event.value))} Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª.`;
                    icon = 'ğŸ¤’';
                } else {
                    message = `Ø®Ø¨Ø± Ø®ÙˆØ¨! Ø³Ù„Ø§Ù…ØªÛŒ Ø´Ù…Ø§ ${toPersianNum(event.value)} Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.`;
                    icon = 'ğŸ’ª';
                }
            } else if (event.effect === 'happiness') {
                if (event.value < 0) {
                    message = `Ø§ØªÙØ§Ù‚ Ù†Ø§Ø±Ø§Ø­Øª Ú©Ù†Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ø±Ø® Ø¯Ø§Ø¯ Ùˆ Ø´Ø§Ø¯ÛŒ Ø´Ù…Ø§ ${toPersianNum(Math.abs(event.value))} Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª.`;
                    icon = 'ğŸ˜”';
                } else {
                    message = `${event.title} Ø¨Ø§Ø¹Ø« Ø´Ø¯ Ø´Ø§Ø¯ÛŒ Ø´Ù…Ø§ ${toPersianNum(event.value)} Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§Ø¨Ø¯.`;
                    icon = 'ğŸ˜Š';
                }
            } else if (event.effect === 'money') {
                if (event.value < 0) {
                    message = `Ø´Ù…Ø§ ${formatMoney(Math.abs(event.value))} Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯ÛŒØ¯.`;
                    icon = 'ğŸ’¸';
                } else {
                    message = `Ø´Ù…Ø§ ${formatMoney(event.value)} Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`;
                    icon = 'ğŸ’°';
                }
            }
            
            content.innerHTML = `
                <div style="font-size: 48px; text-align: center; margin-bottom: 15px;">${icon}</div>
                <p style="text-align: center; font-size: 18px;">${message}</p>
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="closeModal('lifeEventModal')">Ø¨Ø§Ø´Ù‡</button>
                </div>
            `;
            
            openModal('lifeEventModal');
        }
        
        // Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
        function gameOver() {
            const content = document.getElementById('events');
            
            if (player.health <= 0) {
                content.innerHTML = `<div style="text-align: center; padding: 20px;">
                    <h2>Ù¾Ø§ÛŒØ§Ù† Ø²Ù†Ø¯Ú¯ÛŒ</h2>
                    <p>Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ ${player.name} Ø¯Ø± Ø³Ù† ${toPersianNum(player.age)} Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ù…Ø´Ú©Ù„Ø§Øª Ø³Ù„Ø§Ù…ØªÛŒ Ø§Ø² Ø¯Ù†ÛŒØ§ Ø±ÙØª.</p>
                    <p>Ø¯Ø§Ø±Ø§ÛŒÛŒ Ù†Ù‡Ø§ÛŒÛŒ: ${formatMoney(player.money)}</p>
                    <button onclick="location.reload()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
                </div>`;
            } else {
                content.innerHTML = `<div style="text-align: center; padding: 20px;">
                    <h2>Ù¾Ø§ÛŒØ§Ù† Ø²Ù†Ø¯Ú¯ÛŒ</h2>
                    <p>${player.name} Ø¯Ø± Ø³Ù† ${toPersianNum(player.age)} Ø¨Ø§ Ø¢Ø±Ø§Ù…Ø´ Ø§Ø² Ø¯Ù†ÛŒØ§ Ø±ÙØª.</p>
                    <p>Ø¯Ø§Ø±Ø§ÛŒÛŒ Ù†Ù‡Ø§ÛŒÛŒ: ${formatMoney(player.money)}</p>
                    <button onclick="location.reload()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
                </div>`;
            }
            
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('button').forEach(btn => {
                if (btn.textContent !== 'Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯') {
                    btn.disabled = true;
                }
            });
        }
        
        
