<!DOCTYPE html>
<html>
<head>
    <title>Mining Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; text-align: center; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>بازی ماینینگ</h1>
    <p>توکن‌ها: <span id="tokens">0</span></p>
    <p>زمان باقی‌مونده: <span id="timer">60</span> ثانیه</p>
    <button onclick="startMining()">شروع ماینینگ</button>
    <button onclick="upgradeLevel()">ارتقا سطح</button>
    <script>
        let userId = Telegram.WebApp.initDataUnsafe.user?.id || "test_user";
        let tokens = 0;
        let timeLeft = 60;

        async function startMining() {
            let response = await fetch(`http://localhost:8000/start_block/${userId}`, { method: "POST" });
            let data = await response.json();
            alert(data.message);
            startTimer();
        }

        async function upgradeLevel() {
            let response = await fetch(`http://localhost:8000/upgrade/${userId}`, { method: "POST" });
            let data = await response.json();
            alert(data.message);
        }

        function startTimer() {
            let timer = setInterval(async () => {
                timeLeft--;
                document.getElementById("timer").innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    let response = await fetch("http://localhost:8000/end_block");
                    let data = await response.json();
                    alert(data.message);
                    timeLeft = 60;
                    updateTokens();
                }
            }, 1000);
        }

        async function updateTokens() {
            let response = await fetch(`http://localhost:8000/register/${userId}`, { method: "POST" });
            let user = await (await fetch(`http://localhost:8000/register/${userId}`)).json();
            tokens = user.tokens || 0;
            document.getElementById("tokens").innerText = tokens;
        }
    </script>
</body>
</html>